(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{680:function(a,e,t){"use strict";t.r(e);var d=t(1),l=Object(d.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"live-upgrade-tutorial"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#live-upgrade-tutorial"}},[a._v("#")]),a._v(" Live Upgrade Tutorial")]),a._v(" "),t("p",[a._v("This document demonstrates how a live upgrade can be performed on-chain through a\ngovernance process.")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Start the network and trigger upgrade")]),a._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"IyBzdGFydCBhIGdhaWEgYXBwbGljYXRpb24gZnVsbC1ub2RlCiQgcHN0YWtlZCBzdGFydAoKIyBzZXQgdXAgdGhlIGNsaSBjb25maWcKJCBwc3Rha2VkIGNvbmZpZyB0cnVzdC1ub2RlIHRydWUKJCBwc3Rha2VkIGNvbmZpZyBjaGFpbi1pZCB0ZXN0aW5nCgojIGNyZWF0ZSBhbiB1cGdyYWRlIGdvdmVybmFuY2UgcHJvcG9zYWwKJCBwc3Rha2VkIHR4IGdvdiBzdWJtaXQtcHJvcG9zYWwgc29mdHdhcmUtdXBncmFkZSAmbHQ7cGxhbi1uYW1lJmd0OyBcCi0tdGl0bGUgJmx0O3Byb3Bvc2FsLXRpdGxlJmd0OyAtLWRlc2NyaXB0aW9uICZsdDtwcm9wb3NhbC1kZXNjcmlwdGlvbiZndDsgXAotLWZyb20gJmx0O25hbWUtb3Ita2V5Jmd0OyAtLXVwZ3JhZGUtaGVpZ2h0ICZsdDtkZXNpcmVkLXVwZ3JhZGUtaGVpZ2h0Jmd0OyAtLWRlcG9zaXQgMTAwMDAwMDBzdGFrZQoKIyBvbmNlIHRoZSBwcm9wb3NhbCBwYXNzZXMgeW91IGNhbiBxdWVyeSB0aGUgcGVuZGluZyBwbGFuCiQgcHN0YWtlZCBxdWVyeSB1cGdyYWRlIHBsYW4K"}})],1),a._v(" "),t("li",[t("p",[a._v("Performing an upgrade")]),a._v(" "),t("p",[a._v("Assuming the proposal passes the chain will stop at given upgrade height.")]),a._v(" "),t("p",[a._v("You can stop and start the original binary all you want, but "),t("strong",[a._v("it will refuse to\nrun after the upgrade height")]),a._v(".")]),a._v(" "),t("p",[a._v("We need a new binary with the upgrade handler installed. The logs should look\nsomething like:")]),a._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"RVsyMDE5LTExLTA1fDEyOjQ0OjE4LjkxM10gVVBHUkFERSAmcXVvdDsmbHQ7cGxhbi1uYW1lJmd0OyZxdW90OyBORUVERUQgYXQgaGVpZ2h0OiAmbHQ7ZGVzaXJlZC11cGdyYWRlLWhlaWdodCZndDs6ICAgICAgIG1vZHVsZT1tYWluCkVbMjAxOS0xMS0wNXwxMjo0NDoxOC45MTRdIENPTlNFTlNVUyBGQUlMVVJFISEhCi4uLgo="}}),a._v(" "),t("p",[a._v("Note that the process will hang indefinitely (doesn't exit to avoid restart loops). So, you must\nmanually kill the process and replace it with a new binary. Do so now with "),t("code",[a._v("Ctrl+C")]),a._v(" or "),t("code",[a._v("killall gaiad")]),a._v(".")]),a._v(" "),t("p",[a._v("In "),t("code",[a._v("gaia/app/app.go")]),a._v(", after "),t("code",[a._v("upgrade.Keeper")]),a._v(" is initialized and set in the app, set the the\ncorresponding upgrade "),t("code",[a._v("Handler")]),a._v(" with the correct "),t("code",[a._v("<plan-name>")]),a._v(":")]),a._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ICAgIGFwcC51cGdyYWRlS2VlcGVyLlNldFVwZ3JhZGVIYW5kbGVyKCZxdW90OyZsdDtwbGFuLW5hbWUmZ3Q7JnF1b3Q7LCBmdW5jKGN0eCBzZGsuQ29udGV4dCwgcGxhbiB1cGdyYWRlLlBsYW4pIHsKICAgICAgICAvLyBjdXN0b20gbG9naWMgYWZ0ZXIgdGhlIG5ldHdvcmsgdXBncmFkZSBoYXMgYmVlbiBleGVjdXRlZAogICAgfSkK"}}),a._v(" "),t("p",[a._v("Note that we panic on any error - this would cause the upgrade to fail if the\nmigration could not be run, and no node would advance - allowing a manual recovery.\nIf we ignored the errors, then we would proceed with an incomplete upgrade and\nhave a very difficult time every recovering the proper state.")]),a._v(" "),t("p",[a._v("Now, compile the new binary and run the upgraded code to complete the upgrade:")]),a._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"IyBjcmVhdGUgYSBuZXcgYmluYXJ5IG9mIGdhaWEgd2l0aCB0aGUgYWRkZWQgdXBncmFkZSBoYW5kbGVyCiQgbWFrZSBpbnN0YWxsCgojIFJlc3RhcnQgdGhlIGNoYWluIHVzaW5nIHRoZSBuZXcgYmluYXJ5LiBZb3Ugc2hvdWxkIHNlZSB0aGUgY2hhaW4gcmVzdW1lIGZyb20KIyB0aGUgdXBncmFkZSBoZWlnaHQ6CiMgYElbMjAxOS0xMS0wNXwxMjo0ODoxNS4xODRdIGFwcGx5aW5nIHVwZ3JhZGUgJmx0O3BsYW4tbmFtZSZndDsgYXQgaGVpZ2h0OiAmbHQ7ZGVzaXJlZC11cGdyYWRlLWhlaWdodCZndDsgICAgICBtb2R1bGU9bWFpbmAKJCBwc3Rha2VkIHN0YXJ0CgojIHZlcmlmeSB0aGVyZSBpcyBubyBwZW5kaW5nIHBsYW4KJCBwc3Rha2VkIHF1ZXJ5IHVwZ3JhZGUgcGxhbgoKIyB2ZXJpZnkgeW91IGNhbiBxdWVyeSB0aGUgYmxvY2sgaGVhZGVyIG9mIHRoZSBjb21wbGV0ZWQgdXBncmFkZQokIHBzdGFrZWQgcXVlcnkgdXBncmFkZSBhcHBsaWVkICZsdDtwbGFuLW5hbWUmZ3Q7Cg=="}})],1)])])}),[],!1,null,null,null);e.default=l.exports}}]);